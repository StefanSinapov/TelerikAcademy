// Generated by CoffeeScript 1.7.1
(function() {
  var host, listening, page, port, server, system, url;

  page = require("webpage").create();

  server = require("webserver").create();

  system = require("system");

  host = void 0;

  port = void 0;

  if (system.args.length !== 2) {
    console.log("Usage: server.js <some port>");
    phantom.exit(1);
  } else {
    port = system.args[1];
    listening = server.listen(port, function(request, response) {
      console.log("GOT HTTP REQUEST");
      console.log(JSON.stringify(request, null, 4));
      response.statusCode = 200;
      response.headers = {
        Cache: "no-cache",
        "Content-Type": "text/html"
      };
      response.setHeader("foo", "bar");
      response.write("<html><head><title>YES!</title></head>");
      response.write("<body><p>pretty cool :)</body></html>");
      return response.close();
    });
    if (!listening) {
      console.log("could not create web server listening on port " + port);
      phantom.exit();
    }
    url = "http://localhost:" + port + "/foo/bar.php?asdf=true";
    console.log("SENDING REQUEST TO:");
    console.log(url);
    page.open(url, function(status) {
      if (status !== "success") {
        console.log("FAIL to load the address");
      } else {
        console.log("GOT REPLY FROM SERVER:");
        console.log(page.content);
      }
      return phantom.exit();
    });
  }

}).call(this);

//# sourceMappingURL=server.map
